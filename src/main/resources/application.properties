# ===========================
# Datasource (usa ENV en Render)
# ===========================
# En Render: DB_URL debe incluir sslmode=require
# Ej: jdbc:postgresql://<host>:5432/<db>?sslmode=require
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/fuentes}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:postgre}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hikari (más seguro para free tier)
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.idle-timeout=60000
spring.datasource.hikari.connection-timeout=30000

# ===========================
# JPA / Hibernate
# ===========================
# En prod recomendación: none (si el esquema ya existe).
# Usá update solo si necesitás que altere tablas.
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.open-in-view=false
# Quitar el dialecto: Hibernate lo detecta solo (evita warning)
# spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# Arranque un poco más rápido (lazy bean init)
spring.main.lazy-initialization=true

# ===========================
# Actuator / Métricas
# ===========================
# Para que Render haga health check
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

# Latencias por endpoint
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# Tags útiles
management.metrics.tags.service=${DD_SERVICE:fuente}
management.metrics.tags.env=${DD_ENV:prod}
management.metrics.tags.version=${DD_VERSION:1.0.0}

# ===========================
# Micrometer -> Datadog (directo a API)
# ===========================
management.datadog.metrics.export.enabled=true
management.datadog.metrics.export.api-key=${DD_API_KEY}
management.datadog.metrics.export.uri=https://api.${DD_SITE:datadoghq.com}
management.datadog.metrics.export.step=30s
# Para debug (ver URL exacta de envío). Dejar en INFO normalmente.
logging.level.io.micrometer.datadog=INFO
# logging.level.io.micrometer.datadog=DEBUG

# ===========================
# DevTools (desactivar en prod)
# ===========================
spring.devtools.restart.enabled=false
